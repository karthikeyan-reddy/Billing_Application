!function(c){var s=/[\-\[\]{}()*+?.,\\\^$|#\s]/g,h={contains:"{{term}}",beginsWith:"^{{term}}",endsWith:"{{term}}$",exactMatch:"^{{term}}$",containsNumber:"d",isNumeric:"^d+$",isNonNumeric:"^D+$"},n=".ui-multiselect-header",l="ui-multiselect-hasfilter",r="ui-multiselect-optgroup",o="ui-multiselect-excluded";c.widget("ech.multiselectfilter",{options:{label:"Filter:",placeholder:"Enter keywords",filterRule:"contains",searchGroups:!1,autoReset:!1,width:null,debounceMS:250},_create:function(){var e=this.options,t=this.element;this.instance=t.data("ech-multiselect"),this.$header=this.instance.$menu.find(n).addClass(l),this.$input=c(document.createElement("input")).attr({placeholder:e.placeholder,type:"search"}).css({width:"string"==typeof e.width?this.instance._parse2px(e.width,this.$header).px+"px":/\d/.test(e.width)?e.width+"px":null}),this._bindInputEvents(),this.options.autoReset&&t.on("multiselectbeforeclose",c.proxy(this._reset,this));e=c(document.createElement("label")).text(e.label).append(this.$input).addClass("ui-multiselect-filter-label");this.$wrapper=c(document.createElement("div")).addClass("ui-multiselect-filter").append(e).prependTo(this.$header),this.instance._isOpen&&this.instance._setMenuHeight(!0),this.updateCache();var i=this.instance,s=this.$input[0];i._oldToggleChecked=i._toggleChecked,i._toggleChecked=function(e,t){i._oldToggleChecked(e,t,!!s.value)}},_bindInputEvents:function(){var s,n,l,a;this.$input.on({keydown:function(e){if(13===e.which)e.preventDefault();else if(27===e.which)$element.multiselect("close"),e.preventDefault();else if(9===e.which&&e.shiftKey)$element.multiselect("close"),e.preventDefault();else if(e.altKey)switch(e.which){case 82:e.preventDefault(),c(this).val("").trigger("input","");break;case 65:$element.multiselect("checkAll");break;case 85:$element.multiselect("uncheckAll");break;case 70:$element.multiselect("flipAll");break;case 76:$element.multiselect("instance").$labels.first().trigger("mouseenter")}},input:c.proxy((s=this._handler,n=this.options.debounceMS,function(){var e=this,t=arguments,i=l&&!a;clearTimeout(a),a=setTimeout(function(){a=null,l||s.apply(e,t)},n),i&&s.apply(e,t)}),this),search:c.proxy(this._handler,this)})},_handler:function(e){var t=this.$input[0].value.toLowerCase().replace(/^\s+|\s+$/g,""),i=this.options.filterRule||"contains",n=new RegExp((h[i]||i).replace("{{term}}",t.replace(s,"\\$&")),"i"),l=!!this.options.searchGroups,i=this.instance.$checkboxes,a=this.cache;this.$rows.toggleClass(o,!!t);i=i.children().map(function(t){var i=this,e=c(i),s=!1;if(i.classList.contains(r)){e=e.find("li");if(l&&n.test(a[t]))return i.classList.remove(o),e.removeClass(o),e.find("input").get()}return e.map(function(e){return n.test(a[t+"."+e])?(s||(i.classList.remove(o),s=!0),this.classList.remove(o),this.getElementsByTagName("input")[0]):null})});t&&this._trigger("filter",e,i),!this.instance.options.listbox&&this.instance._isOpen&&(this.instance._setMenuHeight(!0),this.instance.position())},_reset:function(){this.$input.val("");var e=document.createEvent("Event");e.initEvent("reset",!0,!0),this.$input.get(0).dispatchEvent(e),this._handler(e)},updateCache:function(e){var i={};this.instance.$checkboxes.children().each(function(t){var e=c(this);this.classList.contains(r)&&(i[t]=this.getElementsByClassName("ui-multiselect-grouplabel")[0].textContent,e=e.find("li")),e.each(function(e){i[t+"."+e]=this.textContent})}),this.cache=i,this.$rows=this.instance.$checkboxes.find("li"),e&&this._handler()},widget:function(){return this.$wrapper},destroy:function(){c.Widget.prototype.destroy.call(this),this.$input.val("").trigger("keyup").off("keydown input search"),this.instance.$menu.find(n).removeClass(l),this.$wrapper.remove()}})}(jQuery);